<div class="container">
  <!-- Seletor de Mês -->
  <div class="month-selector">
    <select [(ngModel)]="mesSelecionado" (change)="carregarDados()">
      <option *ngFor="let mes of meses" [value]="mes">{{ mes }}</option>
    </select>
  </div>

  <!-- Formulários -->
  <div class="forms-container">
    <!-- Formulário de Gasto -->
    <div class="form-card">
      <h3>Adicionar Gasto</h3>
      
      <form (ngSubmit)="adicionarGasto()">
        <div class="form-group">
          <select [(ngModel)]="novoGasto.categoria" name="categoria" required>
            <option value="">Selecione a categoria</option>
            <option value="CreditCard">Cartão de Crédito</option>
            <option value="Transporte">Transporte - (Uber)</option>
            <option value="Moradia">Moradia</option>
            <option value="Lazer">Lazer</option>
          </select>
          <div *ngIf="fieldErrors.gasto_categoria" class="error-message">
            {{ fieldErrors.gasto_categoria }}
          </div>
        </div>

        <div class="form-group">
          <input type="text" [(ngModel)]="novoGasto.descricao" name="descricao" placeholder="Descrição">
        </div>

        <div class="form-group">
          <input type="number" [(ngModel)]="novoGasto.valor" name="valor" placeholder="Valor" min="0.01" step="0.01" required>
          <div *ngIf="fieldErrors.gasto_valor" class="error-message">
            {{ fieldErrors.gasto_valor }}
          </div>
        </div>

        <button type="submit" [disabled]="loading">
          {{ loading ? 'Salvando...' : 'Adicionar Gasto' }}
        </button>
      </form>
      <hr />
      <div class="form-group">
        <label for="arquivoCSV">Importar gastos via CSV</label>
        <input
          #inputCsv
          id="arquivoCSV"
          type="file"
          accept=".csv"
          (change)="onCSVSelecionado($event, inputCsv)"
          class="input-csv"
        />
      </div>

      <button (click)="importarGastos()" [disabled]="gastosImportadosTemp.length === 0">
        Importar Gastos
      </button>

      
      <div *ngIf="gastosImportadosTemp.length > 0" class="preview-list">
        <h4>Prévia dos Gastos Importados</h4>
        <ul>
          <li *ngFor="let gasto of gastosImportadosTemp">
            {{ gasto.descricao }} - {{ gasto.valor | currency:'BRL' }}
          </li>
        </ul>
      </div>

    </div>

    <!-- Formulário de Receita -->
    <div class="form-card">
      <h3>Adicionar Receita</h3>
      <form (ngSubmit)="adicionarReceita()">
        <div class="form-group">
          <input type="text" [(ngModel)]="novaReceita.descricao" name="descricao" placeholder="Descrição" required>
          <div *ngIf="fieldErrors.receita_descricao" class="error-message">
            {{ fieldErrors.receita_descricao }}
          </div>
        </div>

        <div class="form-group">
          <input type="number" [(ngModel)]="novaReceita.valor" name="valor" placeholder="Valor" min="0.01" step="0.01" required>
          <div *ngIf="fieldErrors.receita_valor" class="error-message">
            {{ fieldErrors.receita_valor }}
          </div>
        </div>

        <button type="submit" [disabled]="loading">
          {{ loading ? 'Salvando...' : 'Adicionar Receita' }}
        </button>
      </form>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading-indicator">
    Processando...
  </div>

  <!-- Resumo Financeiro -->
  <div class="summary-card" *ngIf="!loading">
    <h2>Resumo - {{ mesSelecionado }}</h2>
    
    <div class="summary-item">
      <span>Total Receitas:</span>
      <span class="positive">{{ resumo.totalReceitas | currency:'BRL' }}</span>
    </div>
    
    <div class="summary-item">
      <span>Total Gastos:</span>
      <span class="negative">{{ resumo.totalGastos | currency:'BRL' }}</span>
    </div>
    
    <div class="summary-item balance">
      <span>Saldo:</span>
      <span [class.positive]="resumo.saldo >= 0" [class.negative]="resumo.saldo < 0">
        {{ resumo.saldo | currency:'BRL' }}
      </span>
    </div>
  </div>

  <!-- Listas -->
  <div class="lists-container" *ngIf="!loading">
    <!-- Lista de Gastos -->
    <div class="list-card">
      <h3>Gastos</h3>
      <ul>
        <li *ngFor="let gasto of gastos" [class.pago]="gasto.pago">
          <div class="gasto-info">
            <strong>{{ gasto.categoria }}</strong>: {{ gasto.descricao }}
            <span class="valor negative">- {{ gasto.valor | currency:'BRL' }}</span>
          </div>
          
          <div class="acoes">
            <button *ngIf="!gasto.pago" (click)="marcarPago(gasto)" class="btn-pago">
              <i class="material-icons">check</i> Marcar Pago
            </button>
            <span *ngIf="gasto.pago" class="pago-label">
              <i class="material-icons">check_circle</i> Pago
            </span>
            <button (click)="apagarGasto(gasto.id!)" class="btn-excluir">
              <i class="material-icons">delete</i>
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Lista de Receitas -->
    <div class="list-card">
      <h3>Receitas</h3>
      <ul>
        <li *ngFor="let receita of receitas">
          <div class="receita-info">
            {{ receita.descricao }}
            <span class="valor positive">+ {{ receita.valor | currency:'BRL' }}</span>
          </div>
          
          <div class="acoes">
            <button (click)="apagarReceita(receita.id!)" class="btn-excluir">
              <i class="material-icons">delete</i>
            </button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>