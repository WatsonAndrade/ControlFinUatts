<div class="cabecalho-container">
  <div class="logo-area">
    <span class="logo">ðŸ’° Finance<span class="logo-highlight">Control</span></span>
    <div class="acoes-rapidas">
      <button class="btn-visao">ðŸ“… VisÃ£o Mensal</button>
      <button class="btn-resumo">ðŸ“Š Resumo Anual</button>
    </div>
  </div>

  <h1 class="titulo">Controle Financeiro Mensal</h1>
  <p class="subtitulo">Gerencie suas finanÃ§as de forma inteligente e organizada</p>

  <div class="selectores">
    <div class="seletor">
      <label for="ano">Ano</label>
      <select id="ano" [(ngModel)]="anoSelecionado" (change)="carregarDados()">
        <option *ngFor="let ano of anos" [value]="ano">{{ ano }}</option>
      </select>
    </div>
    <div class="seletor">
      <label for="mes">MÃªs</label>
      <select id="mes" [(ngModel)]="mesSelecionado" (change)="carregarDados()">
        <option *ngFor="let mes of meses" [value]="mes">{{ mes }}</option>
      </select>
    </div>
  </div>
</div>

<div class="resumo-container">
  <!-- Receita Mensal -->
  <div class="bloco-verde">
    <h3>ðŸ’µ Receita Mensal</h3>
    <label for="receitaMensal">SalÃ¡rio/Receita Fixa</label>
    <input type="number" id="receitaMensal" [(ngModel)]="receitaMensal" (input)="atualizarResumo()" />
  </div>

  <!-- Total de Receita -->
  <div class="bloco-receita">
    <h3>ðŸ“ˆ Receita</h3>
    <p>R$ {{ resumo?.totalReceitas?.toFixed(2) || '0,00' }}</p>
  </div>

  <!-- Total de Despesas -->
  <div class="bloco-despesa">
    <h3>ðŸ“‰ Total de Despesas</h3>
    <p>R$ {{ resumo?.totalGastos?.toFixed(2) || '0,00' }}</p>
  </div>

  <!-- Saldo Restante -->
  <div class="bloco-saldo">
    <h3>ðŸ“Š Saldo Restante</h3>
    <p>R$ {{ resumo?.saldo?.toFixed(2) || '0,00' }}</p>
  </div>

  <!-- Resumo RÃ¡pido -->
  <div class="bloco-status">
    <h3>ðŸ“‹ Resumo RÃ¡pido</h3>
    <p><strong>MÃªs:</strong> {{ mesSelecionado }} {{ anoSelecionado }}</p>
    <p>
      <strong>Status:</strong>
      <span [ngStyle]="{'color': resumo?.saldo >= 0 ? '#00ff99' : '#ff5050'}">
        {{ resumo?.saldo >= 0 ? 'Positivo' : 'Negativo' }}
      </span>
    </p>
  </div>
</div>

<!-- FormulÃ¡rio de Gasto -->
<div class="despesas-container">
  <h3>ðŸ“‚ Despesas por Categoria</h3>

  <div class="grid-despesas">
    <div class="input-box"
      *ngFor="let cat of ['CartÃ£o de CrÃ©dito', 'Contas Fixas', 'Transporte', 'Moradia', 'AlimentaÃ§Ã£o', 'Gastos NÃ£o Programados']">
      <label>{{ cat }}</label>
      <input type="number" [(ngModel)]="despesasPorCategoria[cat]" placeholder="0.00"
        (input)="atualizarTotalDespesas()" />
    </div>
  </div>

  <button class="btn-salvar" (click)="salvarDadosCategoria()">ðŸ’¾ Salvar Dados do MÃªs</button>
</div>

<div class="formulario-container">
  <!-- Adicionar Gasto -->
  <div class="form-card">
    <h3>âž• Adicionar Gasto</h3>

    <div class="campo-form">
      <label>DescriÃ§Ã£o</label>
      <input type="text" [(ngModel)]="novoGasto.descricao" placeholder="Ex: Energia elÃ©trica" />
    </div>

    <div class="campo-form">
      <label>Categoria</label>
      <input type="text" [(ngModel)]="novoGasto.categoria" placeholder="Ex: Contas Fixas" />
    </div>

    <div class="campo-form">
      <label>Valor</label>
      <input type="number" [(ngModel)]="novoGasto.valor" placeholder="0.00" />
    </div>

    <button class="btn-adicionar" (click)="adicionarGasto()">ðŸ’¾ Salvar Gasto</button>
  </div>

  <!-- ImportaÃ§Ã£o CSV -->
  <div class="form-card importacao-csv">
    <h3>ðŸ“¥ Importar Gastos via CSV</h3>

    <!-- input escondido visualmente -->
    <input type="file" accept=".csv" (change)="onCSVSelecionado($event, inputCsv)" #inputCsv class="input-csv-real" />

    <!-- botÃ£o que dispara o seletor de arquivos -->
    <button class="btn-importar" (click)="inputCsv.click()">ðŸ“Ž Selecionar Arquivo CSV</button>

    <button class="btn-importar" (click)="importarGastos()" [disabled]="gastosImportadosTemp.length === 0">
      âœ… Importar para o Sistema
    </button>

    <small class="dica-csv">Dica: O arquivo deve conter colunas <code>title</code>, <code>amount</code> e
      <code>date</code>.</small>
  </div>
</div>

<!-- Lista de Gastos -->
<div class="lista-gastos">
  <h3>ðŸ§¾ Lista de Gastos</h3>

  <div class="acoes-lote" *ngIf="existeSelecionado()">
    <button class="btn-deletar-lote" (click)="deletarSelecionados()">ðŸ—‘ Excluir Selecionados</button>
  </div>

  <table class="tabela-gastos" *ngIf="gastos.length > 0; else semDados">
    <thead>
      <tr>
        <th>
          <input type="checkbox" (change)="selecionarTodosGastos(obterCheckboxMarcado($event))" />
        </th>
        <th>DescriÃ§Ã£o</th>
        <th>Categoria</th>
        <th>Valor</th>
        <th>Pago</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let g of gastos">
        <td><input type="checkbox" [(ngModel)]="gastoSelecionado[g.id!]" /></td>
        <td>{{ g.descricao }}</td>
        <td>{{ g.categoria }}</td>
        <td>R$ {{ g.valor.toFixed(2) }}</td>
        <td>
          <span class="tag" [ngClass]="g.pago ? 'pago' : 'nao-pago'">
            {{ g.pago ? 'Sim' : 'NÃ£o' }}
          </span>
        </td>
        <td>
          <button class="btn-acao" (click)="marcarPago(g)" [disabled]="g.pago">âœ…</button>
          <button class="btn-acao btn-trash" (click)="apagarGasto(g.id!)">ðŸ—‘</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #semDados>
    <p class="sem-dados">Nenhum gasto encontrado para o mÃªs selecionado.</p>
  </ng-template>
</div>